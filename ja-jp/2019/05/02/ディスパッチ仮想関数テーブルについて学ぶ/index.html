<!DOCTYPE html>
<html lang="ja-jp" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta name="generator" content="Hugo 0.54.0" />
  <meta charset="utf-8">
  <title>ディスパッチ・仮想関数テーブルについて学ぶ · Lazy Lambda</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="目的 プログラミングにおいて頻出する「ディスパッチ」という概念についての学習記録を残す。 参考文献 本文中に記す。 ディスパッチとは ディスパッチとは" />

  <meta name="keywords" content="programming, make" />

<link rel="canonical" href="https://otaon.github.io/web/ja-jp/2019/05/02/%E3%83%87%E3%82%A3%E3%82%B9%E3%83%91%E3%83%83%E3%83%81%E4%BB%AE%E6%83%B3%E9%96%A2%E6%95%B0%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E5%AD%A6%E3%81%B6/" />

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<link rel="stylesheet" href="https://otaon.github.io/web/css/den.css">




<meta property="og:title" content="ディスパッチ・仮想関数テーブルについて学ぶ" />
<meta property="og:description" content="目的 プログラミングにおいて頻出する「ディスパッチ」という概念についての学習記録を残す。 参考文献 本文中に記す。 ディスパッチとは ディスパッチとは" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://otaon.github.io/web/ja-jp/2019/05/02/%E3%83%87%E3%82%A3%E3%82%B9%E3%83%91%E3%83%83%E3%83%81%E4%BB%AE%E6%83%B3%E9%96%A2%E6%95%B0%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E5%AD%A6%E3%81%B6/" />
<meta property="article:published_time" content="2019-05-02T00:00:00&#43;09:00"/>
<meta property="article:modified_time" content="2019-05-02T00:00:00&#43;09:00"/>

<meta itemprop="name" content="ディスパッチ・仮想関数テーブルについて学ぶ">
<meta itemprop="description" content="目的 プログラミングにおいて頻出する「ディスパッチ」という概念についての学習記録を残す。 参考文献 本文中に記す。 ディスパッチとは ディスパッチとは">


<meta itemprop="datePublished" content="2019-05-02T00:00:00&#43;09:00" />
<meta itemprop="dateModified" content="2019-05-02T00:00:00&#43;09:00" />
<meta itemprop="wordCount" content="4485">



<meta itemprop="keywords" content="programming,ディスパッチ,多重ディスパッチ,仮想関数テーブル," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ディスパッチ・仮想関数テーブルについて学ぶ"/>
<meta name="twitter:description" content="目的 プログラミングにおいて頻出する「ディスパッチ」という概念についての学習記録を残す。 参考文献 本文中に記す。 ディスパッチとは ディスパッチとは"/>
</head>
<body>
  
  <div class="header-container" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('https://otaon.github.io/web/images/background.jpg'); background-position: center; background-size: cover;">
  <div class="container">
  <nav class="header-nav navbar navbar-expand-md navbar-dark light-dark">
    <div class="header-logo navbar-brand">
      
        <a class="float-left" href="https://otaon.github.io/web/ja-jp/">
      
        
        <img class="mr20 header-logo-image" src="https://otaon.github.io/web/images/night.svg" alt="logo">
        
        
          LL
         
      </a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="nav-menu collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://otaon.github.io/web/ja-jp/categories/">カテゴリ</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://otaon.github.io/web/ja-jp/category/notes/">ノート</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://otaon.github.io/web/ja-jp/category/demos/">デモ</a>
              
            
          </li>
        
          <li class="nav-item">
            
              <a class="nav-link" href="https://otaon.github.io/web/ja-jp/about/">このサイトについて</a>
            
          </li>
        
        
          
            <li class="nav-item">
              <a class="nav-link" href="https://otaon.github.io/web/en/"><i class="fas fa-globe"></i> English</a>
            </li>
          
          
          
          
        
      </ul>
    </div>
  </nav>
</div>

<div class="container header-wrapper">
  <div class="row">
    <div class="col-lg-12">
      <div class="header-content">
        <h1 class="header-title">ディスパッチ・仮想関数テーブルについて学ぶ</h1>
        <p class="header-date">著者：
          otaon /
        
        2019-05-02
          / カテゴリ：
          <a href="https://otaon.github.io/web/ja-jp/category/programming/">programming</a>
        </p>
        
        <div class="header-underline"></div>
        
          <div class="clearfix"></div>
          <p class="float-right header-tags">
              <i class="fas fa-tags" aria-hidden="true"></i>
              <a href="https://otaon.github.io/web/ja-jp/tag/programming/">programming</a>, 
                <a href="https://otaon.github.io/web/ja-jp/tag/%E3%83%87%E3%82%A3%E3%82%B9%E3%83%91%E3%83%83%E3%83%81/">ディスパッチ</a>, 
                <a href="https://otaon.github.io/web/ja-jp/tag/%E4%BB%AE%E6%83%B3%E9%96%A2%E6%95%B0%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB/">仮想関数テーブル</a>, 
                <a href="https://otaon.github.io/web/ja-jp/tag/%E5%A4%9A%E9%87%8D%E3%83%87%E3%82%A3%E3%82%B9%E3%83%91%E3%83%83%E3%83%81/">多重ディスパッチ</a>
          </p>
        
        

      </div>
    </div>
  </div>
</div>

  </div>
  <main>
<div class="container content">
  <article>
  
    <section class="js-toc">
  <div class="toc">
  <nav id="TableOfContents">
<ul>
<li><a href="#目的">目的</a></li>
<li><a href="#参考文献">参考文献</a></li>
<li><a href="#ディスパッチとは">ディスパッチとは</a>
<ul>
<li><a href="#単一ディスパッチ">単一ディスパッチ</a>
<ul>
<li><a href="#単一ディスパッチでのプログラム例">単一ディスパッチでのプログラム例</a></li>
</ul></li>
<li><a href="#多重ディスパッチ">多重ディスパッチ</a>
<ul>
<li><a href="#多重ディスパッチでのプログラム例">多重ディスパッチでのプログラム例</a></li>
</ul></li>
</ul></li>
<li><a href="#仮想関数テーブルとは">仮想関数テーブルとは</a>
<ul>
<li><a href="#ポリモーフィズム-部分型付け-と仮想関数テーブルの関連性">ポリモーフィズム(部分型付け)と仮想関数テーブルの関連性</a></li>
<li><a href="#仮想関数テーブルの役割と仕組み">仮想関数テーブルの役割と仕組み</a>
<ul>
<li><a href="#仮想関数テーブルの実装例-単一ディスパッチ用">仮想関数テーブルの実装例(単一ディスパッチ用)</a>
<ul>
<li><a href="#test-c-各クラスのインスタンス化とメソッド呼び出し"><code>Test.c</code>: 各クラスのインスタンス化とメソッド呼び出し</a>
<ul>
<li><a href="#test-c">Test.c</a></li>
</ul></li>
<li><a href="#shape-h-各クラスの定義-メンバ変数と-メソッド定義に必要な準備"><code>Shape.h</code>: 各クラスの定義(メンバ変数と、メソッド定義に必要な準備)</a>
<ul>
<li><a href="#shape-h">Shape.h</a></li>
</ul></li>
<li><a href="#shape-c-各クラスの定義-メソッド定義"><code>Shape.c</code>: 各クラスの定義(メソッド定義)</a>
<ul>
<li><a href="#shape-c">Shape.c</a>
<ul>
<li><a href="#include-部分"><code>#include</code>部分</a></li>
<li><a href="#shapeクラス定義部分">Shapeクラス定義部分</a></li>
<li><a href="#rectangleクラス定義部分">Rectangleクラス定義部分</a></li>
<li><a href="#circleクラス定義部分">Circleクラス定義部分</a></li>
</ul></li>
</ul></li>
<li><a href="#実行結果">実行結果</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</section>

  
  

<h1 id="目的">目的</h1>

<p>プログラミングにおいて頻出する「ディスパッチ」という概念についての学習記録を残す。</p>

<h1 id="参考文献">参考文献</h1>

<p>本文中に記す。</p>

<h1 id="ディスパッチとは">ディスパッチとは</h1>

<p>ディスパッチとは、多重定義されたメソッド等に対して、そこで呼び出されるべき定義を1つに特定して実行すること。<br />
ここで、多重定義は、特定されるべきメソッドをクラス毎に定義するものではなく、複数クラスに渡って定義することを指す。<br />
詳細は下記「単一ディスパッチ」「多重ディスパッチ」の章を参照。</p>

<p><a href="https://ja.wikipedia.org/wiki/%E5%A4%9A%E9%87%8D%E3%83%87%E3%82%A3%E3%82%B9%E3%83%91%E3%83%83%E3%83%81">Wikipedia - 多重ディスパッチ</a></p>

<h2 id="単一ディスパッチ">単一ディスパッチ</h2>

<p>単一ディスパッチ(Single dispatch)とは、ディスパッチする際に、1個の引数(レシーバのみ)が関与して特殊化が行われるもの。</p>

<h3 id="単一ディスパッチでのプログラム例">単一ディスパッチでのプログラム例</h3>

<p>宇宙船や小惑星といったオブジェクトが出てくるゲームを想定する。<br />
2つのオブジェクトが衝突する場合、何と何が衝突するかによってプログラムは様々な反応をすると想定する。</p>

<p>Java のように単一ディスパッチのみ行う言語では、コードは次のようになる（ただし、Visitorパターンをこれに活用することも可能）。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// &#34;instanceof&#34; オペレータを使って、実行時のデータ型比較をする
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Asteroid</span> <span class="kd">extends</span> <span class="n">Thing</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">collide_with</span><span class="o">(</span><span class="n">Thing</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">Asteroid</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 小惑星と小惑星の衝突を処理
</span><span class="c1"></span>        <span class="o">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">Spaceship</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 小惑星と宇宙船の衝突を処理
</span><span class="c1"></span>        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Spaceship</span> <span class="kd">extends</span> <span class="n">Thing</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">collide_with</span><span class="o">(</span><span class="n">Thing</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">Asteroid</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 宇宙船と小惑星の衝突を処理
</span><span class="c1"></span>        <span class="o">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">Spaceship</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 宇宙船と宇宙船の衝突を処理
</span><span class="c1"></span>        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p><strong>注意</strong><br />
上記の例で引数の型を検査するのにオーバーロードを用いずに<code>instanceof</code>を使っているのは、オーバーロードを用いると、静的型に対して型の検査してしまうため。
したがって、もし下記の<code>Asteroid</code>と<code>Spaceship</code>が継承関係にあったら、下記のコードは想定どおりに動かない。</p>

<p>例えば、下記のオーバーロードを用いたコードでは静的型を検査するため、インスタンスが実際にどのクラスなのかを見ずにメソッドが特定される。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// オーバーロードを用いて、静的にデータ型比較をする
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Asteroid</span> <span class="kd">extends</span> <span class="n">Thing</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">collide_with</span><span class="o">(</span><span class="n">Asteroid</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 小惑星と小惑星の衝突を処理
</span><span class="c1"></span>    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">collide_with</span><span class="o">(</span><span class="n">Spaceship</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 小惑星と宇宙船の衝突を処理
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Spaceship</span> <span class="kd">extends</span> <span class="n">Thing</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">collide_with</span><span class="o">(</span><span class="n">Asteroid</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 宇宙船と小惑星の衝突を処理
</span><span class="c1"></span>    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">collide_with</span><span class="o">(</span><span class="n">Spaceship</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 宇宙船と宇宙船の衝突を処理
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h2 id="多重ディスパッチ">多重ディスパッチ</h2>

<p>多重ディスパッチ(Multiple dispatch)またはマルチメソッド(Multimethods)とは、ディスパッチする際に、2個以上の引数(レシーバ含む)が関与して特定（特殊化）がおこなわれるもの。</p>

<h3 id="多重ディスパッチでのプログラム例">多重ディスパッチでのプログラム例</h3>

<p>単一ディスパッチと同様に、宇宙船や小惑星といったオブジェクトが出てくるゲームを想定する。<br />
2つのオブジェクトが衝突する場合、何と何が衝突するかによってプログラムは様々な反応をすると想定する。</p>

<p>Common Lispのように多重ディスパッチをする言語では、コードは次のようになる。<br />
CLOSでは、メソッドはクラス内ではなく、独立して定義される。このとき、レシーバも引数にする。<br />
したがって、CLOSにおいてメソッドをディスパッチする際は、全ての引数の動的型を検査する。</p>
<div class="highlight"><pre class="chroma"><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="nv">defmethod</span> <span class="nv">collide-with</span> <span class="p">((</span><span class="nv">x</span> <span class="nv">asteroid</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">asteroid</span><span class="p">))</span>
  <span class="c1">;; 小惑星が小惑星に衝突する場合を処理</span>
  <span class="o">...</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defmethod</span> <span class="nv">collide-with</span> <span class="p">((</span><span class="nv">x</span> <span class="nv">asteroid</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">spaceship</span><span class="p">))</span>
  <span class="c1">;; 小惑星が宇宙船に衝突する場合を処理</span>
  <span class="o">...</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defmethod</span> <span class="nv">collide-with</span> <span class="p">((</span><span class="nv">x</span> <span class="nv">spaceship</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">asteroid</span><span class="p">))</span>
  <span class="c1">;; 宇宙船が小惑星に衝突する場合を処理</span>
  <span class="o">...</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defmethod</span> <span class="nv">collide-with</span> <span class="p">((</span><span class="nv">x</span> <span class="nv">spaceship</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">spaceship</span><span class="p">))</span>
  <span class="c1">;; 宇宙船が宇宙船に衝突する場合を処理</span>
  <span class="o">...</span><span class="p">)</span></code></pre></div>
<h1 id="仮想関数テーブルとは">仮想関数テーブルとは</h1>

<h2 id="ポリモーフィズム-部分型付け-と仮想関数テーブルの関連性">ポリモーフィズム(部分型付け)と仮想関数テーブルの関連性</h2>

<p>ポリモーフィズム(部分型付け)とは、基本型が使われている箇所を完全に置き換え可能な部分型を定義すること。
そして、ポリモーフィック(多相)なメソッドを呼び出す際、呼び出し対象のメソッドを特定するために<strong>仮想関数テーブル</strong>を使用する。<br />
ポリモーフィズムの詳細については「<a href="/web/ja-jp/2019/05/01/%E3%83%9D%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%95%E3%82%A3%E3%82%BA%E3%83%A0%E9%83%A8%E5%88%86%E5%9E%8B%E4%BB%98%E3%81%91%E6%B4%BE%E7%94%9F%E5%9E%8B/">ポリモーフィズム・部分型付け・派生型</a>」を参照。</p>

<h2 id="仮想関数テーブルの役割と仕組み">仮想関数テーブルの役割と仕組み</h2>

<p><strong>仮想関数テーブル(vtable)</strong>とは、クラスごとに定義された、クラスメソッドorオブジェクトメソッドの関数ポインタのテーブルのこと。
各オブジェクトは自らのクラスのvtableへのポインタを持つ。</p>

<p>仮想関数テーブルの仕組みの概要は下記の通り。</p>

<ul>
<li>各々のインスタンスが、自身のメソッドを登録するための関数ポインタのテーブル(=<strong>仮想関数テーブル</strong>)を確保する。<br />

<ul>
<li>クラスは継承関係にあってもなくても構わない。</li>
</ul></li>
<li>インスタンス化の際、同一シグニチャの関数は自身の仮想関数テーブルの同一箇所に登録される。

<ul>
<li>派生型の仮想関数テーブルでは、派生型用の関数ポインタで基本型用に登録された関数ポインタを<strong>上書き登録</strong>する。</li>
</ul></li>
<li>あるインスタンスからメソッドを呼び出すと、そのインスタンスが持つ仮想関数テーブルに登録された関数ポインタが参照する関数を呼び出す(=ディスパッチする)。</li>
</ul>

<p>ディスパッチには、先述したとおり大別して2種類ある(単一ディスパッチ、多重ディスパッチ)。</p>

<p><a href="https://ja.wikipedia.org/wiki/%E3%83%9D%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%95%E3%82%A3%E3%82%BA%E3%83%A0#%E9%83%A8%E5%88%86%E5%9E%8B%E4%BB%98%E3%81%91">Wikipedia - ポリモーフィズム#部分型付け</a></p>

<blockquote>
<ul>
<li>多くのオブジェクト指向言語では、<strong>仮想関数の呼び出しに1番目の引数 (<code>this</code>オブジェクト)の vtable だけを参照する単一ディスパッチ</strong>を採用している。<br /></li>
<li>つまりその他の引数の実行時の型は仮想関数の呼び出しに全く無関係である。<br /></li>
<li>一方でCommon Lisp Object System(CLOS)などでは、<strong>メソッドの呼び出しが全ての引数に対して多相的となる多重ディスパッチ</strong>を採用している。</li>
</ul>
</blockquote>

<h3 id="仮想関数テーブルの実装例-単一ディスパッチ用">仮想関数テーブルの実装例(単一ディスパッチ用)</h3>

<p>この章では、上記の仮想関数テーブルについての説明を、実装例によって理解する。<br />
ここでは、Javaなどで採用されている「単一ディスパッチ」における仮想関数テーブルの実装を例示する。</p>

<p>まず、仮想関数テーブルの動作を理解するために、下記サイトの説明とサンプルコードを使用した。
ここで掲載されているコードを少々修正し、コメントを補いつつ下記に引用する。<br />
<a href="https://ufcpp.net/study/csharp/oo_vftable.html">++C++; - [雑記] 仮想関数テーブル</a></p>

<p>このコードでは、下記を実施している。</p>

<ul>
<li>基本クラス<code>Shape</code>と、派生クラス<code>Rectangle</code>, <code>Circle</code>を定義する。</li>
<li>各々のクラスで面積と周囲長を求めるメソッドを実装する。</li>
</ul>

<h4 id="test-c-各クラスのインスタンス化とメソッド呼び出し"><code>Test.c</code>: 各クラスのインスタンス化とメソッド呼び出し</h4>

<p>処理の説明はコード中のコメントに残した。本文では要点のみ説明する。</p>

<p>このプログラムにおけるクラスのインスタンス化は、下記の通り行う。<br />
これにより、派生型のインスタンスを、基本型の変数に代入したことになる。</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">SuperClassType</span> <span class="n">variable</span> <span class="o">=</span> <span class="p">(</span><span class="n">SuperClassType</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DerivedClassType</span><span class="p">));</span>
</code></pre></div>
<p>また、各インスタンスのメソッド呼び出しは下記の通り行う。<br />
<code>define</code>部分は、仮想関数テーブルにおいて呼び出し対象のメソッドが格納されているエントリのオフセットを表す。<br />
<code>typedef</code>部分は、呼び出し対象のメソッドの型を表す。
メソッド呼び出し部分では、仮想関数テーブルから呼び出し対象のメソッドを取り出し、適切な型キャストをした上で呼び出している。</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#define VF_MethodType1 1
</span><span class="cp"></span>
<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">MethodType1</span><span class="p">)(</span><span class="n">SuperClassType</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>

<span class="n">i</span> <span class="o">=</span> <span class="p">((</span><span class="n">MethodType1</span><span class="p">)</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">vftable</span><span class="p">[</span><span class="n">VF_MethodType1</span><span class="p">])(</span><span class="n">variable</span><span class="p">);</span>
</code></pre></div>
<h5 id="test-c">Test.c</h5>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&#34;ShapeC.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">Shape</span><span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">%f</span><span class="se">\n</span><span class="s">%f</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">,</span>
        <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">vftable</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>    <span class="c1">// クラス名(型情報)
</span><span class="c1"></span>        <span class="p">((</span><span class="n">TypeGetArea</span><span class="p">)</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">vftable</span><span class="p">[</span><span class="n">VF_GetArea</span><span class="p">])(</span><span class="n">s</span><span class="p">),</span>    <span class="c1">// GetArea()呼び出し
</span><span class="c1"></span>        <span class="p">((</span><span class="n">TypeGetPerimeter</span><span class="p">)</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">vftable</span><span class="p">[</span><span class="n">VF_GetPerimeter</span><span class="p">])(</span><span class="n">s</span><span class="p">));</span>    <span class="c1">// GetPerimeter()呼び出し
</span><span class="c1"></span><span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Shape</span><span class="o">*</span> <span class="n">s</span><span class="p">;</span>

    <span class="c1">// Shapeクラスの動作確認
</span><span class="c1"></span>    <span class="c1">//s = (Shape*)malloc(sizeof(Shape));
</span><span class="c1"></span>    <span class="c1">//Shape_Constructor(s);
</span><span class="c1"></span>    <span class="c1">//Shape_Destructor(s);
</span><span class="c1"></span>    <span class="c1">//free(s);
</span><span class="c1"></span>
    <span class="c1">// Rectangleクラスの動作確認
</span><span class="c1"></span>    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Shape</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">));</span>
    <span class="n">Rectangle_Constructor</span><span class="p">((</span><span class="n">Rectangle</span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">Rectangle_Destructor</span><span class="p">((</span><span class="n">Rectangle</span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>

    <span class="c1">// Circleクラスの動作確認
</span><span class="c1"></span>    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Shape</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Circle</span><span class="p">));</span>
    <span class="n">Circle_Constructor</span><span class="p">((</span><span class="n">Circle</span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="mf">1.41421356</span><span class="p">);</span>
    <span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">Circle_Destructor</span><span class="p">((</span><span class="n">Circle</span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="shape-h-各クラスの定義-メンバ変数と-メソッド定義に必要な準備"><code>Shape.h</code>: 各クラスの定義(メンバ変数と、メソッド定義に必要な準備)</h4>

<h5 id="shape-h">Shape.h</h5>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#pragma once
</span><span class="cp"></span>
<span class="c1">//----------------------------------------------------------------
</span><span class="c1">// class Shape に相当
</span><span class="c1"></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TagShape</span> <span class="p">{</span>
    <span class="c1">// 仮想関数テーブル
</span><span class="c1"></span>    <span class="kt">void</span><span class="o">**</span> <span class="n">vftable</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Shape</span><span class="p">;</span>

<span class="c1">// 仮想関数テーブルでGetArea()が格納されているオフセット
</span><span class="c1"></span><span class="cp">#define VF_GetArea 1
</span><span class="cp"></span><span class="c1">// 仮想関数テーブルでGetPerimeter()が格納されているオフセット
</span><span class="c1"></span><span class="cp">#define VF_GetPerimeter 2
</span><span class="cp"></span>
<span class="c1">// 関数ポインタ用にtypedef
</span><span class="c1">//// TypeGetArea
</span><span class="c1"></span><span class="k">typedef</span> <span class="nf">double</span> <span class="p">(</span><span class="o">*</span><span class="n">TypeGetArea</span><span class="p">)(</span><span class="n">Shape</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>
<span class="c1">//// TypeGetPerimeter
</span><span class="c1"></span><span class="k">typedef</span> <span class="nf">double</span> <span class="p">(</span><span class="o">*</span><span class="n">TypeGetPerimeter</span><span class="p">)(</span><span class="n">Shape</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>

<span class="c1">// Shape用仮想関数テーブル
</span><span class="c1"></span><span class="k">extern</span> <span class="kt">void</span><span class="o">*</span> <span class="n">ShapeVftable</span><span class="p">[];</span>

<span class="c1">// -*- プロトタイプ宣言 -*-
</span><span class="c1">// コンストラクタ・デストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Shape_Constructor</span><span class="p">(</span><span class="n">Shape</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">Shape_Destructor</span><span class="p">(</span><span class="n">Shape</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>

<span class="c1">//----------------------------------------------------------------
</span><span class="c1">// class Rectangle に相当
</span><span class="c1"></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TagRectangle</span> <span class="p">{</span>
    <span class="c1">// 基本型を内包させる
</span><span class="c1"></span>    <span class="n">Shape</span> <span class="n">base</span><span class="p">;</span>

    <span class="c1">// Rectangle特有のメンバ変数
</span><span class="c1"></span>    <span class="kt">double</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">height</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Rectangle</span><span class="p">;</span>

<span class="c1">// Rectangle用仮想関数テーブル
</span><span class="c1"></span><span class="k">extern</span> <span class="kt">void</span><span class="o">*</span> <span class="n">RectangleVftable</span><span class="p">[];</span>

<span class="c1">// -*- プロトタイプ宣言 -*-
</span><span class="c1">// コンストラクタ・デストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Rectangle_Constructor</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">,</span> <span class="kt">double</span> <span class="n">w</span><span class="p">,</span> <span class="kt">double</span> <span class="n">h</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">Rectangle_Destructor</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>
<span class="c1">// メソッド群
</span><span class="c1"></span><span class="kt">double</span> <span class="nf">Rectangle_GetArea</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>
<span class="kt">double</span> <span class="nf">Rectangle_GetPerimeter</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>

<span class="c1">//----------------------------------------------------------------
</span><span class="c1">// class Circle に相当
</span><span class="c1"></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TagCircle</span> <span class="p">{</span>
    <span class="c1">// 基本型を内包させる
</span><span class="c1"></span>    <span class="n">Shape</span> <span class="n">base</span><span class="p">;</span>

    <span class="c1">// Circle特有のメンバ変数
</span><span class="c1"></span>    <span class="kt">double</span> <span class="n">radius</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Circle</span><span class="p">;</span>

<span class="c1">// Circle用仮想関数テーブル
</span><span class="c1"></span><span class="k">extern</span> <span class="kt">void</span><span class="o">*</span> <span class="n">CircleVftable</span><span class="p">[];</span>

<span class="c1">// -*- プロトタイプ宣言 -*-
</span><span class="c1">// コンストラクタ・デストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Circle_Constructor</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">Circle_Destructor</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>
<span class="c1">// メソッド群
</span><span class="c1"></span><span class="kt">double</span> <span class="nf">Circle_GetArea</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>
<span class="kt">double</span> <span class="nf">Circle_GetPerimeter</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">);</span>
</code></pre></div>
<h4 id="shape-c-各クラスの定義-メソッド定義"><code>Shape.c</code>: 各クラスの定義(メソッド定義)</h4>

<p>クラス定義では、メンバ変数、コンストラクタ、メソッド、仮想関数テーブルを定義する。</p>

<p>このプログラムでは、メンバ変数は、それが属すクラスのコンストラクタにおいて初期化される。</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Rectangleのメンバ変数を初期化
</span><span class="c1"></span><span class="k">this</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
<span class="k">this</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
</code></pre></div>
<p>また、メソッドを定義したら、その関数ポインタを仮想関数テーブルの適切なエントリに登録する。<br />
この際、派生クラスの場合は、内包する基本クラスの仮想関数テーブル(<code>this-&gt;base.vftable</code>)を使用する。</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Rectangleクラスの仮想関数テーブル
</span><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="n">RectangleVftable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#34;class Rectangle&#34;</span><span class="p">,</span>        <span class="c1">// クラス名(型情報)
</span><span class="c1"></span>    <span class="n">Rectangle_GetArea</span><span class="p">,</span>        <span class="c1">// Rectangleにおいて定義したGetArea()
</span><span class="c1"></span>    <span class="n">Rectangle_GetPerimeter</span>    <span class="c1">// Rectangleにおいて定義したGetPerimeter()
</span><span class="c1"></span><span class="p">};</span>

<span class="cm">/* コンストラクタ内 */</span>
<span class="c1">// Rectangleのフィールドに仮想関数テーブルを登録(上書き)
</span><span class="c1"></span><span class="k">this</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">.</span><span class="n">vftable</span> <span class="o">=</span> <span class="n">RectangleVftable</span><span class="p">;</span>
</code></pre></div>
<h5 id="shape-c">Shape.c</h5>

<h6 id="include-部分"><code>#include</code>部分</h6>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&#34;ShapeC.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stddef.h&gt;</span><span class="cp">
</span></code></pre></div>
<h6 id="shapeクラス定義部分">Shapeクラス定義部分</h6>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//----------------------------------------------------------------
</span><span class="c1">// class Shape に相当
</span><span class="c1"></span>
<span class="c1">// コンストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Shape_Constructor</span><span class="p">(</span><span class="n">Shape</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Shapeのフィールドに仮想関数テーブルを登録
</span><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">vftable</span> <span class="o">=</span> <span class="n">ShapeVftable</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// デストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Shape_Destructor</span><span class="p">(</span><span class="n">Shape</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// Shapeクラスの仮想関数テーブル
</span><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="n">ShapeVftable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#34;class Shape&#34;</span><span class="p">,</span>    <span class="c1">// クラス名(型情報)
</span><span class="c1"></span>    <span class="nb">NULL</span><span class="p">,</span>             <span class="c1">// ShapeにおいてGetArea()は未定義なのでnull
</span><span class="c1"></span>    <span class="nb">NULL</span>              <span class="c1">// ShapeにおいてGetPerimeter()は未定義なのでnull
</span><span class="c1"></span><span class="p">};</span>
</code></pre></div>
<h6 id="rectangleクラス定義部分">Rectangleクラス定義部分</h6>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//----------------------------------------------------------------
</span><span class="c1">// class Rectangle に相当
</span><span class="c1"></span>
<span class="c1">// コンストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Rectangle_Constructor</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">,</span> <span class="kt">double</span> <span class="n">w</span><span class="p">,</span> <span class="kt">double</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 基本クラスのコンストラクタを呼び出す
</span><span class="c1"></span>    <span class="n">Shape_Constructor</span><span class="p">(</span><span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">);</span>

    <span class="c1">// Rectangleのフィールドに仮想関数テーブルを登録(上書き)
</span><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">.</span><span class="n">vftable</span> <span class="o">=</span> <span class="n">RectangleVftable</span><span class="p">;</span>

    <span class="c1">// Rectangleのメンバ変数を初期化
</span><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// デストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Rectangle_Destructor</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 基本クラスのデストラクタを呼び出す
</span><span class="c1"></span>    <span class="n">Shape_Destructor</span><span class="p">(</span><span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// メソッド群
</span><span class="c1"></span>
<span class="kt">double</span> <span class="nf">Rectangle_GetArea</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="nf">Rectangle_GetPerimeter</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Rectangleクラスの仮想関数テーブル
</span><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="n">RectangleVftable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#34;class Rectangle&#34;</span><span class="p">,</span>        <span class="c1">// クラス名(型情報)
</span><span class="c1"></span>    <span class="n">Rectangle_GetArea</span><span class="p">,</span>        <span class="c1">// Rectangleにおいて定義したGetArea()
</span><span class="c1"></span>    <span class="n">Rectangle_GetPerimeter</span>    <span class="c1">// Rectangleにおいて定義したGetPerimeter()
</span><span class="c1"></span><span class="p">};</span>
</code></pre></div>
<h6 id="circleクラス定義部分">Circleクラス定義部分</h6>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//----------------------------------------------------------------
</span><span class="c1">// class Circle に相当
</span><span class="c1"></span>
<span class="c1">// コンストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Circle_Constructor</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 基本クラスのコンストラクタを呼び出す
</span><span class="c1"></span>    <span class="n">Shape_Constructor</span><span class="p">(</span><span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">);</span>

    <span class="c1">// Circleのフィールドに仮想関数テーブルを登録(上書き)
</span><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">.</span><span class="n">vftable</span> <span class="o">=</span> <span class="n">CircleVftable</span><span class="p">;</span>

    <span class="c1">// Circleのメンバ変数を初期化
</span><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">radius</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// デストラクタ
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Circle_Destructor</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 基本クラスのデストラクタを呼び出す
</span><span class="c1"></span>    <span class="n">Shape_Destructor</span><span class="p">(</span><span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// メソッド群
</span><span class="c1"></span>
<span class="kt">double</span> <span class="nf">Circle_GetArea</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mf">3.14159265358979</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">radius</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">radius</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="nf">Circle_GetPerimeter</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">3.14159265358979</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">radius</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Circleクラスの仮想関数テーブル
</span><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="n">CircleVftable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#34;class Circle&#34;</span><span class="p">,</span>        <span class="c1">// クラス名(型情報)
</span><span class="c1"></span>    <span class="n">Circle_GetArea</span><span class="p">,</span>        <span class="c1">// Circleにおいて定義したGetArea()
</span><span class="c1"></span>    <span class="n">Circle_GetPerimeter</span>    <span class="c1">// Circleにおいて定義したGetPerimeter()
</span><span class="c1"></span><span class="p">};</span>
</code></pre></div>
<h4 id="実行結果">実行結果</h4>

<p>実行結果は下記の通り。インスタンスの型によって呼び出されるメソッドが異なることが分かる。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ./test.exe
class Rectangle
<span class="m">6</span>.000000
<span class="m">10</span>.000000

class Circle
<span class="m">6</span>.283185
<span class="m">8</span>.885766</code></pre></div>
  </article>

  
  
    
    <div class="author-card">
    <div class="underline"></div>
    <div class="author-box">
      <div class="author-image"><a href="https://github.com/otaon"><img src="/web/images/otaon.png" alt="otaon" /></a></div>
      <div class="author-content">
      <p class="author-title">著者</p>
      <p class="author-name">otaon</p>
      <p class="author-desc">こんにちは</p>
      </div>
    </div>
  </div>
    
  
  


</div>

  </main><div class="footer gradient-2">
  <div class="container footer-container ">
    <div class="row">
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        <div class="footer-title">サイトマップ</div>
        <ul class="list-unstyled">
            
              
                <li><a href="https://otaon.github.io/web/ja-jp/tags/">タグ</a></li>
              
              
                <li><a href="https://otaon.github.io/web/ja-jp/categories/">カテゴリ</a></li>
              
            
            
            
            <li><a rel="alternate" type="application/rss&#43;xml" href="https://otaon.github.io/web/ja-jp/index.xml"><i class="fas fa-rss-square"></i> RSS Feed</a></li>
            
            
            
        </ul>
      </div>
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        
        <div class="footer-title">SNS</div>
        <ul class="list-unstyled">
          
          <li><a href="https://github.com/otaon" rel="noopener" target="_blank">GitHub</a></li>
          
        </ul>
        
      </div>
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        
        <div class="footer-title">リンク</div>
        <ul class="list-unstyled">
          
          <li><a href="https://github.com/otaon" rel="noopener" target="_blank">サイト作者</a></li>
          
        </ul>
        
      </div> 
      <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
        <p class="pull-right text-right">
          <small><em>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo</a></em></small><br/>
          <small><em>Theme - <a href="https://github.com/shaform/hugo-theme-den" rel="noopener" target="_blank">Den</a></em></small><br/>
          <small>
            &copy; 
            otaon
            2019
          </small>
          
        </p>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="/web/asset/mermaid/mermaid.js"></script>

</body>
</html>
