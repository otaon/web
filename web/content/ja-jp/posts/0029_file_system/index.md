---
title: "ファイルシステムの概要"
date:    2019-03-24T00:00:00+09:00
lastmod: 2019-03-24T00:00:00+09:00
draft: false
tags: ["file system"]
categories: ["Notes"]
authors:
- otaon
---

# 目的
極単純なファイルシステムを自作できる程度の知識を、初歩的な事柄をまとめる。

# 参考文献
- [ファイルシステム](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=2ahUKEwix1PLmnKDhAhUKO3AKHShZBOMQFjAAegQIBBAC&url=http%3A%2F%2Fresearch.nii.ac.jp%2F~ichiro%2Flecture%2Fos2001%2Fnotes%2FOS2001-file.pdf&usg=AOvVaw15ZC6zFCuZreyMzU2s0TAA)


# ファイルシステムとは
> ファイルシステムは、コンピュータのリソースを操作するための、オペレーティングシステム (OS) が持つ機能の一つ。  
> ファイルとは、主に補助記憶装置に格納されたデータを指すが、デバイスやプロセス、カーネル内の情報といったものもファイルとして提供するファイルシステムもある。  
> より正確に定義すれば、ファイルシステムは抽象データ型の集まりであり、ストレージ、階層構造、データの操作/アクセス/検索のために実装されたものである。

[Wikipedia - ファイルシステム](https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0)

**NOTE:** ファイルシステムを操作するためには、OSが提供する機能を利用することになる。

# ディスクファイルシステムとは
> 「ディスクファイルシステム」は、直接的か間接的かに関わらずコンピュータシステムに接続された補助記憶装置、特にハードディスク上にファイルを格納するためのものである。
> ディスクファイルシステムとしては、FAT、NTFS、HFS、ext2、ext3、ext4、WAFL（英語版）、ISO 9660、ODS-5（英語版）、UDF、HPFS、JFS、UFS、VTOC、XFSなどがある。
> ディスクファイルシステムの一部はジャーナルファイルシステムまたはバージョニングファイルシステムでもある。 

[Wikipedia - ファイルシステム](https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0)

# ファイルシステムへの要求
ファイルシステム、特にディスクファイルシステムへの要求

- メモリと比較して低速な読み書き速度に対応できる
- 記憶装置の容量を無駄無く利用できる
- 信頼性・耐障害性が高い
- 記憶装置の容量拡大に容易に対応できる
- 記憶装置の物理的な差異を吸収する論理インターフェースを提供できる

# ファイルの操作
OSが提供するシステムコール、または、APIによってファイルを操作する。

- `OPEN` ファイルアクセスに先立ち、ディスク上のファイルの位置を調べる。また、バッファ領域を含むファイル入出力に必要な情報領域(テーブル)を作成する。
- `CLOSE` ファイル入出力にテーブルの領域を解放する。
- `READ` ファイルからメモリにデータを読み出す
- `WRITE` メモリからファイルにデータを書き込む
- `SEEK` ファイルのアクセス位置を変更する

```
* read操作　または write操作
                       vアクセス位置
ファイル先頭 [    |    |    |    |    |    |    |    |    |    ]
                        ---> 読み出し(または書き出し)データサイズ分だけ進める
```

```
* seek操作
                       vアクセス位置
ファイル先頭 [    |    |    |    |    |    |    |    |    |    ]
          巻き戻し <--- ---> 先送り
```

# アクセス方法
## ファイルのアクセス（読み出し・書き込み）の方法
- 順アクセス
  - ファイルの先頭から末尾に向かってアクセス（`read`、`write`を使用)
- 直接アクセス
  - ファイル上の任意の位置をアクセス（`seek`、`read`、`write`を使用)
- 検索付き直接アクセス
  - キー値からアクセス対象となるレコードを取得・アクセス

# ファイルの管理情報
ファイルを管理するための代表的な情報を下記に示す。

- 名前
- 属性
- 物理的位置（ブロック）
- 大きさ（サイズ）
- 保護情報（アクセス権）
- 参照時間、生成時間

**NOTE**  
ファイルの管理情報とファイル本体を結ぶ部分をディレクトリと呼ぶ。  
ディレクトリに管理情報そのものを保持、または、ディレクトリに管理情報のある領域（ブロック）のポインタを保持する。

# ディレクトリ構造
1階層のみのファイルシステムだと同一ファイル名を扱えない。  
そこで、多階層のディレクトリ構造を導入する。

- 1階層のみのファイルシステム・・・同一の名前空間となり、名前が衝突する。

{{<mermaid align="center">}}
graph TD;
	root[root];
	root-->a((file a));
	root-->b((file b));
	root-->c((file c));
	root-->d((file d));
{{</mermaid>}}

- 多階層のファイルシステム・・・異なるディレクトリでは異なる名前空間となる。

{{<mermaid align="center">}}
graph TD;
	root[root];
	root-->a((file a));
	root-->b((file b));
	root-->dir1[dir 1];
	root-->dir2[dir 2];
	dir1-->c((file a));
	dir1-->d((file b));
	dir2-->dir2_1[dir 2-1];
	dir2_1-->e((file a));
	dir2_1-->f((file b));
	dir2-->dir2_2[dir 2-2];
	dir2_2-->g((file a));
	dir2_2-->h((file b));
{{</mermaid>}}

# ファイルの実装
- 磁気テープの場合は、先頭から末尾まで、順番にヘッドを走査するしかない。  
- 磁気ディスクの場合は、ランダムアクセス可能。→記憶媒体へのファイル配置方法は多様。
  1. 連続方式
  1. 連結リスト方式
  1. 索引方式

**NOTE**  
OSは、ブロック(セクタサイズの整数倍)単位で読み書きする。

# ブロック
多くのOSにおいては、ディスクを、セクタを要素とする1次元配列として管理する。

多くのＯＳがディスクをセクタを要素とする１次元配列として管理

- セクタの指定方法
- シリンダ番号、ヘッド番号（ディスク番号）、セクタ番号の３項組
- セクタサイズ
  - システムに依存（代表的サイズ:512B）
- ブロック
  - ＯＳがハードディスクを読み書きする際のデータ単位
- ブロックサイズ
  - ＯＳに依存。ただし、512B、1024B、2048B、4096B、8192Bなど
- **注意** ブロックサイズが大きいと
  - ○ まとめて入出力処理が可能なため高速化
  - × ファイルサイズがブロックサイズより小さいと無駄が多い

{{<figure src="Disk-structure2.svg" alt="ディスクセクタ" align="aligncenter" width="200" caption="A トラック<br/>B （幾何学的）セクタ<br/>C トラックセクタ<br/>D クラスタ">}}



# ボリューム


# ファイルの割り当て方式
## 連続方式(contiguous)


## 連結リスト方式(list)


## リスト検索表方式(list)


## 索引方式(index)
